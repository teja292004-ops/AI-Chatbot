<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Assistant - Professional</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        .container {
            width: 100%;
            max-width: 800px;
            height: 92vh;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #7e22ce 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .header h1 { 
            font-size: 28px; 
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .header p { 
            font-size: 14px; 
            opacity: 0.95;
            font-weight: 300;
        }
        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            font-size: 12px;
        }
        .stat-item {
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 15px;
        }
        .messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: linear-gradient(to bottom, #f8f9fa 0%, #e9ecef 100%);
        }
        .message {
            margin-bottom: 18px;
            padding: 14px 18px;
            border-radius: 20px;
            max-width: 80%;
            word-wrap: break-word;
            animation: slideIn 0.4s ease-out;
            line-height: 1.6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message.user {
            background: linear-gradient(135deg, #7e22ce 0%, #a855f7 100%);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        .message.ai {
            background: white;
            color: #1e293b;
            border: 2px solid #e2e8f0;
            border-bottom-left-radius: 5px;
        }
        .message.system {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #78350f;
            text-align: center;
            margin: 10px auto;
            font-size: 13px;
            font-weight: 500;
        }
        .input-area {
            display: flex;
            padding: 20px;
            background: white;
            border-top: 3px solid #e2e8f0;
            gap: 10px;
            flex-wrap: wrap;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.05);
        }
        .input-row {
            display: flex;
            gap: 10px;
            width: 100%;
        }
        .input-area input[type="text"] {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid #cbd5e1;
            border-radius: 25px;
            font-size: 15px;
            outline: none;
            transition: all 0.3s;
        }
        .input-area input[type="text"]:focus { 
            border-color: #7e22ce;
            box-shadow: 0 0 0 3px rgba(126, 34, 206, 0.1);
        }
        .input-area button {
            padding: 14px 28px;
            background: linear-gradient(135deg, #7e22ce 0%, #a855f7 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(126, 34, 206, 0.3);
        }
        .input-area button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(126, 34, 206, 0.4);
        }
        .input-area button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: translateY(0);
        }
        .image-btn {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.3);
        }
        .image-btn:hover {
            box-shadow: 0 6px 20px rgba(30, 60, 114, 0.4);
        }
        .doc-btn {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        }
        .doc-btn:hover {
            box-shadow: 0 6px 20px rgba(5, 150, 105, 0.4);
        }
        .doc-preview {
            padding: 10px 15px;
            background: #f0fdf4;
            border: 2px solid #10b981;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 14px;
            color: #065f46;
        }
        .clear-btn {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            padding: 14px 20px;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }
        .clear-btn:hover {
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
        }
        .image-preview {
            width: 100%;
            max-width: 200px;
            border-radius: 12px;
            margin-top: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .message img {
            max-width: 100%;
            border-radius: 12px;
            margin-top: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        input[type="file"] {
            display: none;
        }
        .footer {
            padding: 12px;
            text-align: center;
            font-size: 12px;
            color: #64748b;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            font-weight: 500;
        }
        .typing-indicator {
            display: none;
            padding: 10px 15px;
            background: white;
            border-radius: 20px;
            width: fit-content;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .typing-indicator.active {
            display: block;
        }
        .typing-indicator span {
            height: 8px;
            width: 8px;
            background: #7e22ce;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: bounce 1.4s infinite;
        }
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        .theme-toggle {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 10px;
        }
        .theme-toggle button {
            background: rgba(255,255,255,0.2);
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            color: white;
            transition: all 0.3s;
        }
        .theme-toggle button:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }
        body.dark-mode {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #581c87 100%);
        }
        body.dark-mode .container {
            background: rgba(30, 30, 50, 0.95);
        }
        body.dark-mode .messages {
            background: linear-gradient(to bottom, #1e293b 0%, #0f172a 100%);
        }
        body.dark-mode .message.ai {
            background: #334155;
            color: #e2e8f0;
            border-color: #475569;
        }
        body.dark-mode .input-area {
            background: #1e293b;
        }
        body.dark-mode .input-area input[type="text"] {
            background: #334155;
            color: #e2e8f0;
            border-color: #475569;
        }
        body.dark-mode .footer {
            background: #1e293b;
            color: #94a3b8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AI Chat Assistant</h1>
            <p>Powered by Hugging Face AI Models | Chat, Image Analysis, Document Analysis & Image Generation</p>
            <div class="stats">
                <div class="stat-item">Messages: <span id="msgCount">0</span></div>
                <div class="stat-item">Images: <span id="imgCount">0</span></div>
                <div class="stat-item">Documents: <span id="docCount">0</span></div>
                <div class="stat-item">Time: <span id="timer">00:00</span></div>
            </div>
            <div class="theme-toggle">
                <button id="themeBtn" title="Toggle Dark Mode">Dark Mode</button>
                <button id="voiceBtn" title="Voice Input">Voice</button>
                <button id="exportBtn" title="Export Chat">Export</button>
            </div>
        </div>
        <div class="messages" id="messages">
            <div class="message system">Welcome to AI Chatbot! I can chat, analyze images and documents, generate images, and accept voice input. How can I help you?</div>
            <div class="typing-indicator" id="typing">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="input-area">
            <div class="input-row">
                <input type="text" id="input" placeholder="Type your message, upload image or document..." autocomplete="off">
                <input type="file" id="imageInput" accept="image/*">
                <input type="file" id="docInput" accept=".pdf,.doc,.docx,.txt">
                <button class="image-btn" id="imageBtn">Image</button>
                <button class="doc-btn" id="docBtn">Document</button>
                <button class="clear-btn" id="clearBtn">Clear</button>
                <button id="send">Send</button>
            </div>
            <div id="imagePreview"></div>
            <div id="docPreview"></div>
        </div>
        <div class="footer">
            Created by Teja Â© 2025 | Powered by Hugging Face AI Models | <span id="status">Online</span>
        </div>
    </div>
    <script>
        const API_KEY = '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';
        const messages = document.getElementById('messages');
        const input = document.getElementById('input');
        const send = document.getElementById('send');
        const imageBtn = document.getElementById('imageBtn');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const docBtn = document.getElementById('docBtn');
        const docInput = document.getElementById('docInput');
        const docPreview = document.getElementById('docPreview');
        const clearBtn = document.getElementById('clearBtn');
        const typing = document.getElementById('typing');
        const themeBtn = document.getElementById('themeBtn');
        const voiceBtn = document.getElementById('voiceBtn');
        const exportBtn = document.getElementById('exportBtn');
        const timerDisplay = document.getElementById('timer');
        let selectedImage = null;
        let selectedDoc = null;
        let messageCount = 0;
        let imageCount = 0;
        let docCount = 0;
        let startTime = Date.now();
        let isDarkMode = false;
        let recognition = null;
        
        // Timer
        setInterval(() => {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const mins = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const secs = (elapsed % 60).toString().padStart(2, '0');
            timerDisplay.textContent = `${mins}:${secs}`;
        }, 1000);
        
        // Dark Mode Toggle
        themeBtn.onclick = () => {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');
            themeBtn.textContent = isDarkMode ? 'Light Mode' : 'Dark Mode';
            localStorage.setItem('darkMode', isDarkMode);
        };
        
        // Load saved theme
        if (localStorage.getItem('darkMode') === 'true') {
            themeBtn.click();
        }
        
        // Voice Input
        voiceBtn.onclick = () => {
            if (!('webkitSpeechRecognition' in window)) {
                alert('Voice input not supported in your browser. Try Chrome!');
                return;
            }
            
            if (!recognition) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    input.value = transcript;
                    voiceBtn.textContent = 'Voice';
                };
                
                recognition.onerror = () => {
                    voiceBtn.textContent = 'Voice';
                    alert('Voice input failed. Please try again.');
                };
                
                recognition.onend = () => {
                    voiceBtn.textContent = 'Voice';
                };
            }
            
            voiceBtn.textContent = 'ðŸ”´';
            recognition.start();
        };
        
        // Export Chat
        exportBtn.onclick = () => {
            const chatMessages = Array.from(messages.children)
                .filter(msg => !msg.classList.contains('typing-indicator'))
                .map(msg => msg.textContent)
                .join('\n\n');
            
            const blob = new Blob([`AI Chat Export\n${'='.repeat(50)}\nDate: ${new Date().toLocaleString()}\nMessages: ${messageCount}\nImages: ${imageCount}\nDocuments: ${docCount}\n${'='.repeat(50)}\n\n${chatMessages}`], 
                { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `chat-export-${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        };
        
        function updateStats() {
            document.getElementById('msgCount').textContent = messageCount;
            document.getElementById('imgCount').textContent = imageCount;
            document.getElementById('docCount').textContent = docCount;
        }
        
        function addMsg(text, type, imageData = null) {
            const div = document.createElement('div');
            div.className = `message ${type}`;
            div.textContent = text;
            
            if (imageData) {
                const img = document.createElement('img');
                img.src = imageData;
                div.appendChild(img);
            }
            
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }
        
        imageBtn.onclick = () => imageInput.click();
        
        imageInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    selectedImage = event.target.result;
                    imagePreview.innerHTML = `<img src="${selectedImage}" class="image-preview">`;
                };
                reader.readAsDataURL(file);
            }
        };
        
        docBtn.onclick = () => docInput.click();
        
        docInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                selectedDoc = file;
                const fileSize = (file.size / 1024).toFixed(2);
                docPreview.innerHTML = `<div class="doc-preview">ðŸ“„ ${file.name} (${fileSize} KB)</div>`;
            }
        };
        
        async function callAI(message) {
            try {
                const response = await fetch('https://api-inference.huggingface.co/models/facebook/blenderbot-400M-distill', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inputs: message,
                        parameters: {
                            max_length: 200,
                            min_length: 20,
                            temperature: 0.9
                        },
                        options: {
                            wait_for_model: true
                        }
                    })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    if (data.error.includes('loading')) {
                        return "ðŸ”„ AI model is loading (20-30 seconds). Please try again!";
                    }
                    return getSmartResponse(message);
                }
                
                if (Array.isArray(data) && data[0]?.generated_text) {
                    return data[0].generated_text.trim();
                }
                
                if (data.generated_text) {
                    return data.generated_text.trim();
                }
                
                return getSmartResponse(message);
                
            } catch (error) {
                return getSmartResponse(message);
            }
        }
        
        function getSmartResponse(msg) {
            const m = msg.toLowerCase();
            
            if (m.includes('hello') || m.includes('hi') || m.includes('hey') || m.includes('hii')) {
                return "Hello! ðŸ‘‹ I'm your AI assistant. How can I help you today?";
            }
            
            if (m.includes('who are you') || m.includes('what are you')) {
                return "I'm an AI assistant powered by Facebook's BlenderBot model. I'm designed to have natural conversations and help answer your questions. What would you like to talk about?";
            }
            
            if (m.includes('what is ai') || m.includes('artificial intelligence')) {
                return "Artificial Intelligence (AI) is technology that enables machines to simulate human intelligence. This includes learning from data, understanding language, recognizing patterns, and making decisions. AI powers virtual assistants, recommendation systems, autonomous vehicles, and much more. Would you like to know about a specific AI application?";
            }
            
            if (m.includes('how are you')) {
                return "I'm doing great, thank you for asking! I'm here and ready to help you. How are you doing?";
            }
            
            if (m.includes('help')) {
                return "I'm here to help! ðŸ˜Š You can ask me about technology, AI, science, general knowledge, or just have a friendly conversation. What would you like to know?";
            }
            
            if (m.includes('thank')) {
                return "You're very welcome! ðŸ˜Š Happy to help. Feel free to ask me anything else!";
            }
            
            if (m.includes('bye') || m.includes('goodbye')) {
                return "Goodbye! ðŸ‘‹ It was nice chatting with you. Come back anytime!";
            }
            
            return `I understand you're asking about "${msg}". I'm here to help with various topics. The AI model may take a moment to load on first use. Try asking again or rephrase your question!`;
        }
        
        async function sendMsg() {
            const msg = input.value.trim();
            if (!msg && !selectedImage && !selectedDoc) return;
            
            messageCount++;
            if (selectedImage) imageCount++;
            if (selectedDoc) docCount++;
            updateStats();
            
            // Check if user wants to generate an image
            const isImageGenRequest = msg.toLowerCase().includes('generate image') || 
                                     msg.toLowerCase().includes('create image') ||
                                     msg.toLowerCase().includes('draw') ||
                                     msg.toLowerCase().includes('make image') ||
                                     msg.toLowerCase().includes('generate picture');
            
            // Add user message
            let displayMsg = msg || '';
            if (selectedImage) {
                addMsg(displayMsg || 'Sent an image', 'user', selectedImage);
            } else if (selectedDoc) {
                addMsg(`${displayMsg || 'Sent a document'} - ${selectedDoc.name}`, 'user');
            } else {
                addMsg(msg, 'user');
            }
            
            input.value = '';
            imagePreview.innerHTML = '';
            docPreview.innerHTML = '';
            send.disabled = true;
            
            typing.classList.add('active');
            
            let reply;
            if (isImageGenRequest && !selectedImage && !selectedDoc) {
                reply = await generateImage(msg);
            } else if (selectedImage) {
                reply = await analyzeImage(msg, selectedImage);
            } else if (selectedDoc) {
                reply = await analyzeDocument(msg, selectedDoc);
            } else {
                reply = await callAI(msg);
            }
            
            typing.classList.remove('active');
            
            if (typeof reply === 'object' && reply.image) {
                addMsg(reply.text, 'ai', reply.image);
            } else {
                addMsg(reply, 'ai');
            }
            
            selectedImage = null;
            selectedDoc = null;
            send.disabled = false;
            input.focus();
        }
        
        async function generateImage(prompt) {
            try {
                // Extract the description from the prompt
                let description = prompt.toLowerCase()
                    .replace('generate image of', '')
                    .replace('create image of', '')
                    .replace('draw', '')
                    .replace('make image of', '')
                    .replace('generate picture of', '')
                    .trim();
                
                if (!description) {
                    return "Please describe what image you'd like me to generate. For example: 'Generate image of a sunset over mountains'";
                }
                
                const response = await fetch('https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-2-1', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inputs: description,
                        options: {
                            wait_for_model: true
                        }
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    if (error.error && error.error.includes('loading')) {
                        return "The image generation model is loading (this takes 20-30 seconds on first use). Please try again in a moment!";
                    }
                    throw new Error('Image generation failed');
                }
                
                const blob = await response.blob();
                const imageUrl = URL.createObjectURL(blob);
                
                return {
                    text: `Here's your generated image: "${description}"`,
                    image: imageUrl
                };
                
            } catch (error) {
                console.error('Image generation error:', error);
                return `I can generate images for you! Just describe what you want. For example: "Generate image of a beautiful landscape" or "Create image of a futuristic robot". The model may need a moment to load on first use.`;
            }
        }
        
        async function analyzeDocument(message, file) {
            const fileName = file.name;
            const fileType = fileName.split('.').pop().toLowerCase();
            const fileSize = (file.size / 1024).toFixed(2);
            
            return `I received your document "${fileName}" (${fileSize} KB, ${fileType.toUpperCase()} format). ${message ? 'You asked: "' + message + '". ' : ''}I can see you've uploaded a document. While I can't read the full content directly in the browser, I can help you with:\n\nâ€¢ Discussing the document topic\nâ€¢ Answering questions about ${fileType.toUpperCase()} files\nâ€¢ Providing guidance on document analysis\nâ€¢ Suggesting tools for document processing\n\nWhat would you like to know about your document?`;
        }
        
        clearBtn.onclick = () => {
            if (confirm('Clear all messages?')) {
                messages.innerHTML = '<div class="message system">Chat cleared! Start fresh.</div>';
                messageCount = 0;
                imageCount = 0;
                docCount = 0;
                updateStats();
            }
        };
        
        async function analyzeImage(message, imageData) {
            try {
                // Use Hugging Face Vision API
                const base64Data = imageData.split(',')[1];
                const response = await fetch('https://api-inference.huggingface.co/models/Salesforce/blip-image-captioning-large', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inputs: base64Data
                    }),
                    options: {
                        wait_for_model: true
                    }
                });
                
                const data = await response.json();
                
                if (data.error) {
                    return `I can see you sent an image! ${message ? 'You asked: "' + message + '". ' : ''}I'm an AI assistant that can analyze images. The image analysis model is loading. Please try again in a moment!`;
                }
                
                if (Array.isArray(data) && data[0]?.generated_text) {
                    const caption = data[0].generated_text;
                    return `I can see the image! ${caption}. ${message ? 'Regarding your question "' + message + '": ' : ''}What would you like to know about it?`;
                }
                
                return `I received your image! ${message ? 'You asked: "' + message + '". ' : ''}I can see images and describe them. The AI vision model is loading - please try again!`;
                
            } catch (error) {
                return `I see you sent an image! ${message ? 'You asked: "' + message + '". ' : ''}I can analyze images and answer questions about them. Please try again!`;
            }
        }
        
        send.onclick = sendMsg;
        input.onkeypress = (e) => { if (e.key === 'Enter') sendMsg(); };
        input.focus();
    </script>
</body>
</html>
